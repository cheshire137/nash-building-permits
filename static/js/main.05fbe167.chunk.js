(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{23:function(e){e.exports={socrataApi:{appToken:"dHxi5gsFAIc3aO9exCVcmz9uE"}}},26:function(e,t,n){e.exports=n(49)},32:function(e,t,n){},37:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),i=n(15),o=n.n(i),l=(n(32),n(5)),s=n(6),c=n(10),u=n(9),p=n(11),d=n(14),h=n.n(d),m=n(16),f=function(){function e(){Object(l.a)(this,e)}return Object(s.a)(e,null,[{key:"getJSON",value:function(){if(!window.localStorage)return console.error("browser does not support local storage"),{};var e=window.localStorage.getItem("nash-building-permits")||"{}";return JSON.parse(e)}},{key:"get",value:function(e){return this.getJSON()[e]}},{key:"set",value:function(e,t){var n=this.getJSON();n[e]=t,window.localStorage.setItem("nash-building-permits",JSON.stringify(n))}},{key:"delete",value:function(e){var t=this.getJSON();delete t[e],window.localStorage.setItem("nash-building-permits",JSON.stringify(t))}}]),e}(),y=function(){function e(t,n){Object(l.a)(this,e),this.appToken=t,this.baseUrl=n}return Object(s.a)(e,[{key:"urlFor",value:function(e){return"".concat(this.baseUrl).concat(e||"")}},{key:"get",value:function(){var e=Object(m.a)(h.a.mark(function e(t,n){var a,r,i,o,l,s,c;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.urlFor(t),r=f.get("cached-urls")||{},i=f.get("cached-responses")||{},o=new Date,!r[a]){e.next=9;break}if(l=new Date(r[a]),u=o,p=l,!(Math.abs(u.getTime()-p.getTime())/864e5<=1)){e.next=9;break}return console.log("using cached data for",a),e.abrupt("return",i[a]);case 9:return console.log("GET",a),e.next=12,window.fetch(a,{method:"GET",headers:{"Content-Type":"application/json","X-App-Token":this.appToken}});case 12:return s=e.sent,e.next=15,s.json();case 15:return c=e.sent,i[a]=n(c),r[a]=o,f.set("cached-urls",r),f.set("cached-responses",i),e.abrupt("return",i[a]);case 21:case"end":return e.stop()}var u,p},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),g=function(){function e(){Object(l.a)(this,e)}return Object(s.a)(e,null,[{key:"uniq",value:function(e){if(!e)return e;var t={},n=function(e){return e.toString()},a={},r=!0,i=!1,o=void 0;try{for(var l,s=e[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var c=l.value,u=n(c);a[u]=c,t[u]=1}}catch(p){i=!0,o=p}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return Object.keys(t).map(function(e){return a[e]})}}]),e}();g.categorySeparator=" - ";var v=g,b={Commercial:"briefcase",Residential:"home",Other:"more",Repair:"hammer",Demolition:"trash-a",Tree:"leaf",Pool:"waterdrop",Restaurant:"pizza"},C={Commercial:"green",Residential:"blue",Other:"orange"},O=function(){function e(t){Object(l.a)(this,e),this.type=t.type||(t.permit_type_description||"").replace(/^Building /i,""),this.subtype=t.subtype||t.permit_subtype_description,this.address=t.address||t.mapped_location_address,this.city=t.city||t.mapped_location_city,this.state=t.state||t.mapped_location_state,this.zipCode=t.zipCode||t.zip||t.mapped_location_zip,this.contact=t.contact,this.councilDistrict=t.councilDistrict||t.council_dist,this.dateIssued=new Date(t.dateIssued||t.date_issued),t.latitude&&t.longitude?(this.latitude=t.latitude,this.longitude=t.longitude):t.mapped_location&&(this.latitude=t.mapped_location.coordinates[1],this.longitude=t.mapped_location.coordinates[0]),this.permit=t.permit,this.subdivisionLot=t.subdivisionLot||t.subdivision_lot,this.purpose=t.purpose}return Object(s.a)(e,[{key:"key",value:function(){return"".concat(this.permit).concat(this.address).concat(this.type).concat(this.latitude).concat(this.longitude).concat(this.dateIssued).concat(this.purpose).concat(this.contact).concat(this.subtype)}},{key:"category",value:function(){return this.type.indexOf(v.categorySeparator)>-1?this.type.split(v.categorySeparator)[0]:"Other"}},{key:"position",value:function(){if(this.latitude&&this.longitude)return[this.latitude,this.longitude]}},{key:"hasCoordinates",value:function(){return this.position()}},{key:"typeContains",value:function(e){return this.type.toLowerCase().split(/\s+/).indexOf(e)>-1}},{key:"subtypeContains",value:function(e){return this.subtype.toLowerCase().split(/\s+/).indexOf(e)>-1}},{key:"isRepair",value:function(){return this.typeContains("rehab")||this.typeContains("addition")||this.typeContains("roofing")||this.typeContains("fire")||this.typeContains("siding")}},{key:"isDemolition",value:function(){return this.typeContains("demolition")}},{key:"isTree",value:function(){return this.typeContains("tree")}},{key:"isPool",value:function(){return this.subtypeContains("pool")||this.subtypeContains("pools")}},{key:"isRestaurant",value:function(){return this.subtypeContains("restaurant")}},{key:"isCar",value:function(){return this.subtypeContains("carport")||this.subtypeContains("garage")}},{key:"icon",value:function(){return this.isRestaurant()?b.Restaurant:this.isTree()?b.Tree:this.isPool()?b.Pool:this.isRepair()?b.Repair:this.isDemolition()?b.Demolition:b[this.category()]}},{key:"year",value:function(){return this.dateIssued.getFullYear()}},{key:"markerColor",value:function(){return C[this.category()]}},{key:"matches",value:function(e){var t=e.zipCode,n=e.type,a=e.year;return this.matchesZipCode(t)&&this.matchesType(n)&&this.matchesYear(a)}},{key:"matchesYear",value:function(e){return e&&this.year().toString()===e||"all"===e}},{key:"matchesType",value:function(e){if(0===e.indexOf("all-")){var t=e.split("all-")[1];return this.category()===t}return this.type===e||"all"===e}},{key:"matchesZipCode",value:function(e){return this.zipCode===e||"all"===e}}]),e}(),k="https://data.nashville.gov/resource/p5r5-bnga.json?$limit=1500",E=function(e){function t(e){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,e,k))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"getBuildingPermits",value:function(){var e=Object(m.a)(h.a.mark(function e(){var t,n;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"",t=function(e){return e.map(function(e){return new O(e)})},e.next=4,this.get("",t);case 4:return n=e.sent,e.abrupt("return",n.map(function(e){return new O(e)}));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(y),j=n(23),w=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).onChange=function(e){n.props.onChange(e.target.value)},n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.allZipCodes,n=e.selectedZipCode,a=v.uniq(t.sort());return r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"zip",className:"mr-1"},"Zip code:"),r.a.createElement("select",{id:"zip",className:"form-select mr-4",onChange:this.onChange,value:n},r.a.createElement("option",{value:"all"},"All"),a.map(function(e){return r.a.createElement("option",{value:e,key:e},e)})))}}]),t}(a.Component),x=function(e,t){return e.filter(function(e){return e.indexOf(v.categorySeparator)<0?"Other"===t:0===e.indexOf(t)})},N=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).onChange=function(e){n.props.onChange(e.target.value)},n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.allTypes,n=e.selectedType,a=v.uniq(t.sort()),i=function(e){var t=[],n=!0,a=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var l=i.value;if(l.indexOf(v.categorySeparator)>-1){var s=l.split(v.categorySeparator)[0];t.push(s)}}}catch(c){a=!0,r=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}return(t=v.uniq(t.sort())).length<e.length&&t.push("Other"),t}(a),o=function(e,t){var n={},a=!0,r=!1,i=void 0;try{for(var o,l=t[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var s=o.value;n[s]=x(e,s)}}catch(c){r=!0,i=c}finally{try{a||null==l.return||l.return()}finally{if(r)throw i}}return n}(a,i);return r.a.createElement("div",{className:"mr-4"},r.a.createElement("label",{htmlFor:"type",className:"mr-1"},"Permit type:"),r.a.createElement("select",{id:"type",className:"form-select",onChange:this.onChange,value:n},r.a.createElement("option",{value:"all"},"All"),i.map(function(e){return r.a.createElement("optgroup",{label:e,key:e},r.a.createElement("option",{value:"all-".concat(e)},"All ",e),o[e].map(function(e){return r.a.createElement("option",{value:e,key:e},function(e,t){var n=t.filter(function(t){return t===e}).length;if(e.indexOf(v.categorySeparator)<0)return"".concat(e," (").concat(n,")");var a=e.split(v.categorySeparator)[1];return"".concat(a," (").concat(n,")")}(e,t))}))})))}}]),t}(a.Component),S=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).onChange=function(e){n.props.onChange(e.target.value)},n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.allYears,n=e.selectedYear,a=v.uniq(t.sort()).reverse();return r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"year",className:"mr-1"},"Year issued:"),r.a.createElement("select",{id:"year",className:"form-select",onChange:this.onChange,value:n},r.a.createElement("option",{value:"all"},"All"),a.map(function(e){return r.a.createElement("option",{value:e,key:e},function(e,t){var n=t.filter(function(t){return t.toString()===e.toString()}).length;return"".concat(e," (").concat(n,")")}(e,t))})))}}]),t}(a.Component),P=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.buildingPermits,n=e.onZipCodeChange,a=e.zipCode,i=e.onTypeChange,o=e.type,l=e.onYearChange,s=e.year,c=t.map(function(e){return e.zipCode}),u=t.filter(function(e){return e.matchesZipCode(a)}),p=u.map(function(e){return e.type}),d=u.filter(function(e){return e.matchesType(o)}).map(function(e){return e.year()});return r.a.createElement("form",{className:"flex-auto flex-justify-end d-flex flex-items-center"},r.a.createElement(w,{onChange:n,selectedZipCode:a,allZipCodes:c}),r.a.createElement(N,{onChange:i,selectedType:o,allTypes:p}),r.a.createElement(S,{onChange:l,selectedYear:s,allYears:d}))}}]),t}(a.Component),z=n(54),T=n(55),_=n(51),D=n(52),B=n(53),I=n(7),A=n.n(I);n(35),n(36),n(37),n(38);delete A.a.Icon.Default.prototype._getIconUrl,A.a.Icon.Default.mergeOptions({iconRetinaUrl:n(39),iconUrl:n(40),shadowUrl:n(41)});var Y=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.buildingPermits.filter(function(e){return e.hasCoordinates()});if(e.length<1)return r.a.createElement("p",null,"No building permits in the selected area.");var t=function(e){var t=0,n=0,a=!0,r=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var s=o.value;n+=s.longitude,t+=s.latitude}}catch(c){r=!0,i=c}finally{try{a||null==l.return||l.return()}finally{if(r)throw i}}return[t/=e.length,n/=e.length]}(e),n=function(e){var t=e.map(function(e){return e.position()}),n=null,a=null;if(t.length<2)a=13;else{var r=t[0],i=t[0],o=t[0],l=t[0],s=!0,c=!1,u=void 0;try{for(var p,d=t[Symbol.iterator]();!(s=(p=d.next()).done);s=!0){var h=p.value;h[0]<r[0]&&(r=h),h[0]>o[0]&&(o=h),h[1]<i[1]&&(i=h),h[1]>l[1]&&(l=h)}}catch(m){c=!0,u=m}finally{try{s||null==d.return||d.return()}finally{if(c)throw u}}n=[r,i,o,l]}return(!(n=v.uniq(n))||n.length<2)&&(n=null,a=13),{bounds:n,zoom:a}}(e),a=n.bounds,i=n.zoom;return r.a.createElement(z.a,{id:"permit-map",center:t,className:"map__reactleaflet border",bounds:a,zoom:i},r.a.createElement(T.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.map(function(e){return r.a.createElement(_.a,{key:e.key(),position:e.position(),icon:A.a.AwesomeMarkers.icon({icon:e.icon(),markerColor:e.markerColor(),prefix:"ion"})},r.a.createElement(D.a,null,r.a.createElement("div",{className:"mb-1"},e.dateIssued.toLocaleDateString()),r.a.createElement("div",{className:"popup-long-description"},e.purpose)),r.a.createElement(B.a,null,e.subtype))}))}}]),t}(a.Component),Z=n(25),L=(n(46),n(47),function(e){var t=e.original.icon();return r.a.createElement("div",{className:"text-center"},r.a.createElement("i",{className:"ion ion-".concat(t)}))}),R=function(e){var t=e.value;if(t instanceof Date){var n=t.getFullYear(),a=t.getMonth()+1;a<10&&(a="0".concat(a));var i=t.getDate();return i<10&&(i="0".concat(i)),r.a.createElement("div",{className:"text-center"},"".concat(n,"-").concat(a,"-").concat(i))}return r.a.createElement("div",{className:"text-center"},t)},J=function(e){var t=e.value;return r.a.createElement("div",{title:t},t)},F=function(e){var t=e.value;return r.a.createElement("div",{className:"text-center"},t)},H=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.buildingPermits.filter(function(e){return e.hasCoordinates()});return e.length<1?null:r.a.createElement(Z.a,{data:e,columns:[{Header:"",accessor:function(e){return e},id:"icon",headerClassName:"text-bold",Cell:L,width:30,sortable:!1},{Header:"Address",accessor:"address",headerClassName:"text-bold",minWidth:130},{Header:"Zip code",accessor:"zipCode",headerClassName:"text-bold",Cell:F},{Header:"Type",accessor:"type",minWidth:130,headerClassName:"text-bold",Cell:F},{Header:"Sub-type",accessor:"subtype",headerClassName:"text-bold",Cell:J,minWidth:170},{Header:"Council district",headerClassName:"text-bold",accessor:"councilDistrict",Cell:F},{Header:"Date issued",headerClassName:"text-bold",accessor:"dateIssued",minWidth:80,Cell:R}],pageSize:3,showPageSizeOptions:!1,className:"-striped -highlight permit-list"})}}]),t}(a.Component),q=(n(48),"zip-code"),U="type",W="year",M=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).onDataLoaded=function(e){var t=e.filter(function(e){return e.zipCode}).map(function(e){return e.zipCode}).sort(),a=null;t.length>0&&(a=t[0]),n.setState(function(t){var r=f.get(q)||t.zipCode||a,i=f.get(U)||t.type||"all",o=f.get(W)||t.year||"all";return{buildingPermits:e,isLoading:!1,zipCode:r,type:i,year:o,filteredBuildingPermits:n.filterBuildingPermits(e,{zipCode:r,type:i,year:o})}})},n.filterBuildingPermits=function(e,t){return e.filter(function(e){return e.matches(t)})},n.onZipCodeChange=function(e){f.set(q,e),f.set(U,"all"),f.set(W,"all"),n.setState(function(t){return{zipCode:e,type:"all",year:"all",filteredBuildingPermits:n.filterBuildingPermits(t.buildingPermits,{zipCode:e,type:"all",year:"all"})}})},n.onTypeChange=function(e){f.set(U,e),f.set(W,"all"),n.setState(function(t){return{type:e,year:"all",filteredBuildingPermits:n.filterBuildingPermits(t.buildingPermits,{zipCode:t.zipCode,type:e,year:"all"})}})},n.onYearChange=function(e){f.set(W,e),n.setState(function(t){return{year:e,filteredBuildingPermits:n.filterBuildingPermits(t.buildingPermits,{zipCode:t.zipCode,year:e,type:t.type})}})},n.state={isLoading:!0,buildingPermits:[],filteredBuildingPermits:[]},n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){new E(j.socrataApi.appToken).getBuildingPermits().then(this.onDataLoaded)}},{key:"render",value:function(){var e=this.state,t=e.buildingPermits,n=e.isLoading,a=e.zipCode,i=e.type,o=e.year,l=e.filteredBuildingPermits;return r.a.createElement("div",null,r.a.createElement("header",{className:"site-header"},r.a.createElement("div",{className:"container-lg py-2 d-flex flex-items-center flex-justify-between"},r.a.createElement("h1",{className:"f3 text-normal"},"Nashville Building Permits"),n?null:r.a.createElement(P,{buildingPermits:t,zipCode:a,type:i,year:o,onYearChange:this.onYearChange,onZipCodeChange:this.onZipCodeChange,onTypeChange:this.onTypeChange}))),r.a.createElement("main",{className:"site-main"},r.a.createElement("div",{className:"container-lg"},n?r.a.createElement("div",{className:"blankslate"},r.a.createElement("h2",null,"Loading...")):r.a.createElement("div",null,r.a.createElement(Y,{buildingPermits:l}),r.a.createElement(H,{buildingPermits:l})))),r.a.createElement("footer",{className:"site-footer"},r.a.createElement("div",{className:"container-lg text-small py-1 d-flex flex-items-center flex-justify-between"},r.a.createElement("a",{target:"_blank",className:"link-gray",rel:"noopener noreferrer",href:"https://github.com/cheshire137/nash-building-permits"},"View source"),r.a.createElement("span",null,"Data from ",r.a.createElement("a",{target:"_blank",className:"link-gray",rel:"noopener noreferrer",href:"https://data.nashville.gov/Licenses-Permits/Building-Permits-Issued/3h5w-q8b7"},"Nashville Building Permits Issued")))))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[26,1,2]]]);
//# sourceMappingURL=main.05fbe167.chunk.js.map